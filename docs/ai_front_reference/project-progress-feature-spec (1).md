# 프로젝트 달성률 기능 기획서

**버전:** 1.0  
**작성일:** 2025-01-28  
**상태:** 기획 완료

---

## 1. 개요

### 1-1. 목적
프로젝트별 진행 상황을 시각적으로 파악할 수 있는 달성률 기능 구현

### 1-2. 핵심 원칙
- **직관성**: 한눈에 진행 상황 파악
- **단순함**: 복잡한 가중치 없이 일정 개수 기반 계산
- **유연성**: 일정 카테고리를 사용자가 관리 가능

---

## 2. 데이터 구조 변경

### 2-1. 신규 엔티티: ScheduleCategory

| 필드 | 타입 | 설명 | 비고 |
|------|------|------|------|
| id | Long | PK | |
| name | String | 카테고리명 | 설계, 시운전, 회식 등 |
| type | Enum | PROJECT / GENERAL | 달성률 계산 구분용 |
| sortOrder | Int | 정렬 순서 | 선택 |
| createdAt | DateTime | 생성일 | |
| updatedAt | DateTime | 수정일 | |

```kotlin
enum class CategoryType {
    PROJECT,  // 프로젝트 일정 (달성률 포함)
    GENERAL   // 일반 일정 (달성률 제외)
}
```

**기본 데이터 (마이그레이션):**

| name | type |
|------|------|
| 설계 | PROJECT |
| 전기 배선 | PROJECT |
| 시운전 | PROJECT |
| 미팅 | PROJECT |
| 공지 | GENERAL |
| 회식 | GENERAL |
| 휴일 | GENERAL |

### 2-2. Schedule 엔티티 수정

| 변경 | 필드 | 타입 | 설명 |
|------|------|------|------|
| 삭제 | ~~type~~ | ~~Enum~~ | ~~ScheduleType 제거~~ |
| 추가 | categoryId | Long (FK) | ScheduleCategory 참조 |
| 추가 | status | Enum | 일정 상태 |
| 유지 | projectId | Long (FK, nullable) | 일반 일정은 null |

```kotlin
enum class ScheduleStatus {
    TODO,       // 예정
    IN_PROGRESS, // 진행중 (선택적)
    DONE        // 완료
}
```

> **MVP 단순화**: `IN_PROGRESS` 없이 `TODO` / `DONE` 2개만 사용해도 됨

### 2-3. ERD

```
┌─────────────────────┐       ┌─────────────────────┐
│      Project        │       │   ScheduleCategory  │
├─────────────────────┤       ├─────────────────────┤
│ id (PK)             │       │ id (PK)             │
│ name                │       │ name                │
│ description         │       │ type (PROJECT/GEN)  │
│ startDate           │       │ color               │
│ endDate             │       │ sortOrder           │
│ ...                 │       └──────────┬──────────┘
└──────────┬──────────┘                  │
           │                             │
           │ 1:N                         │ 1:N
           │                             │
┌──────────▼─────────────────────────────▼──┐
│                 Schedule                   │
├────────────────────────────────────────────┤
│ id (PK)                                    │
│ title                                      │
│ projectId (FK, nullable)  ← 일반일정은 null │
│ categoryId (FK)                            │
│ status (TODO/DONE)        ← 신규           │
│ startDate                                  │
│ endDate                                    │
│ ...                                        │
└────────────────────────────────────────────┘
```

---

## 3. 달성률 계산 로직

### 3-1. 공식

```
달성률(%) = (완료된 프로젝트 일정 수 / 전체 프로젝트 일정 수) × 100
```

### 3-2. 조건

- `schedule.projectId = 해당 프로젝트`
- `schedule.category.type = PROJECT`
- `schedule.status = DONE` (완료된 것만 분자)

### 3-3. 예시

| 프로젝트 A | 카테고리 | 상태 | 계산 포함 |
|-----------|----------|------|----------|
| 설계 완료 | 설계 (PROJECT) | DONE | ✅ |
| 배선 작업 | 전기배선 (PROJECT) | TODO | ✅ |
| 시운전 | 시운전 (PROJECT) | TODO | ✅ |
| 킥오프 미팅 | 미팅 (PROJECT) | DONE | ✅ |
| 회식 | 회식 (GENERAL) | DONE | ❌ |

**달성률 = 2/4 × 100 = 50%**

### 3-4. 엣지 케이스

| 상황 | 처리 |
|------|------|
| 일정이 0개 | 0% 또는 "-" 표시 |
| 모두 완료 | 100% + 완료 배지 |
| 프로젝트 일정만 0개 | 0% 또는 "-" 표시 |

---

## 4. API 설계

### 4-1. 프로젝트 달성률 조회

**GET** `/api/projects/{projectId}/progress`

```json
// Response
{
  "projectId": 1,
  "projectName": "삼성전자 PLC 공사",
  "progress": {
    "percentage": 50,
    "completedCount": 2,
    "totalCount": 4
  },
  "schedules": [
    {
      "id": 1,
      "title": "설계 완료",
      "categoryName": "설계",
      "status": "DONE"
    },
    {
      "id": 2,
      "title": "배선 작업",
      "categoryName": "전기배선",
      "status": "TODO"
    }
  ]
}
```

### 4-2. 프로젝트 목록 (달성률 포함)

**GET** `/api/projects`

```json
// Response
{
  "content": [
    {
      "id": 1,
      "name": "삼성전자 PLC 공사",
      "progress": 50,
      "status": "IN_PROGRESS"
    },
    {
      "id": 2,
      "name": "LG 시스템 구축",
      "progress": 100,
      "status": "COMPLETED"
    }
  ]
}
```

### 4-3. 일정 상태 변경

**PATCH** `/api/schedules/{scheduleId}/status`

```json
// Request
{
  "status": "DONE"
}

// Response
{
  "id": 1,
  "title": "설계 완료",
  "status": "DONE",
  "projectProgress": 75  // 변경 후 프로젝트 달성률
}
```

### 4-4. 카테고리 CRUD

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/schedule-categories` | 목록 조회 |
| POST | `/api/schedule-categories` | 생성 |
| PUT | `/api/schedule-categories/{id}` | 수정 |
| DELETE | `/api/schedule-categories/{id}` | 삭제 |

---

## 5. UI/UX 설계

### 5-1. 대시보드 - 프로젝트 카드

```
┌─────────────────────────────────────────┐
│  삼성전자 PLC 공사                       │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━░░░░░░░░░░  │
│  ████████████████████░░░░░░░░░░  50%   │
│                                         │
│  📅 2025.01.15 ~ 2025.03.30            │
│  👤 담당: 홍길동                         │
└─────────────────────────────────────────┘
```

### 5-2. 프로젝트 상세 페이지

```
┌─────────────────────────────────────────────────────────┐
│  삼성전자 PLC 공사                              [수정]   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│   진행률: ██████████░░░░░░░░░░  50% (2/4)              │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  일정 목록                                    [+ 추가]  │
├─────────────────────────────────────────────────────────┤
│  설계 완료       [설계]      01.15~01.20   ✓ 완료됨     │
│  배선 작업       [전기배선]   01.21~02.10   [완료]      │
│  시운전          [시운전]     02.11~02.28   [완료]      │
│  킥오프 미팅     [미팅]       01.15         ✓ 완료됨    │
└─────────────────────────────────────────────────────────┘
```

### 5-3. 일정 완료 처리 (완료 버튼)

```
배선 작업  [완료]  →  클릭  →  배선 작업  ✓ 완료됨
                                    │
                                    ▼
                          진행률: 50% → 75%
                          (즉시 적용 + 애니메이션)
```

### 5-4. 카테고리 관리 (설정 페이지)

```
┌─────────────────────────────────────────────────────────┐
│  일정 카테고리 관리                            [+ 추가]  │
├─────────────────────────────────────────────────────────┤
│  설계           PROJECT    [수정] [삭제]                │
│  전기배선       PROJECT    [수정] [삭제]                │
│  시운전         PROJECT    [수정] [삭제]                │
│  미팅           PROJECT    [수정] [삭제]                │
│  ─────────────────────────────────────                  │
│  공지           GENERAL    [수정] [삭제]                │
│  회식           GENERAL    [수정] [삭제]                │
│  휴일           GENERAL    [수정] [삭제]                │
└─────────────────────────────────────────────────────────┘
```

---

## 6. 구현 순서 (클로드 코드용)

### Phase 1: 백엔드 기반 작업
```
1. ScheduleCategory 엔티티 생성
2. CategoryType enum 생성
3. ScheduleStatus enum 생성
4. Schedule 엔티티 수정 (categoryId, status 추가)
5. 마이그레이션 스크립트 (기존 type → category 변환)
```

### Phase 2: 백엔드 API
```
6. ScheduleCategory CRUD API
7. Schedule 상태 변경 API
8. 프로젝트 달성률 조회 API
9. 프로젝트 목록에 달성률 포함
```

### Phase 3: 프론트엔드
```
10. 카테고리 관리 페이지
11. 프로젝트 카드에 진행률 바 추가
12. 프로젝트 상세 페이지 일정 목록 + 체크박스
13. 일정 완료 시 진행률 업데이트 (실시간)
```

---

## 7. 체크리스트

### 백엔드
- [ ] ScheduleCategory 엔티티
- [ ] ScheduleStatus enum
- [ ] Schedule 엔티티 수정
- [ ] DB 마이그레이션
- [ ] 카테고리 CRUD API
- [ ] 일정 상태 변경 API
- [ ] 달성률 계산 로직
- [ ] 프로젝트 API 수정

### 프론트엔드
- [ ] 카테고리 관리 UI
- [ ] 진행률 바 컴포넌트
- [ ] 프로젝트 카드 수정
- [ ] 프로젝트 상세 페이지 수정
- [ ] 일정 완료 버튼 동작

### 테스트
- [ ] 달성률 계산 단위 테스트
- [ ] API 통합 테스트
- [ ] 마이그레이션 테스트

---

## 8. 참고사항

### 8-1. 추후 확장 가능
- 카테고리별 가중치 부여
- 일정 기간 기반 달성률
- 프로젝트 자동 완료 처리 (100% 도달 시)

### 8-2. 의존성
- 기존 Project, Schedule 엔티티
- 기존 인증/권한 시스템

---

**작성자:** Claude  
**검토:** (작성 필요)
